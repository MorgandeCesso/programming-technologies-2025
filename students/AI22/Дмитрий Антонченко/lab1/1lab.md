# Отчет по лабораторной работе №1
## Цель работы

Создать текстового ассистента, который работает через API языковой модели, умеет использовать системные промпты, настраивать креативность ответов через параметр temperature и помнить контекст диалога.

## Реализация

### Технологии

Использовал Python 3.12 и Hugging Face Router API с моделью gpt-oss-120b. Для хранения данных выбрал SQLite, потому что это простая встроенная база данных, которая не требует установки сервера.

Основные библиотеки:
- requests для HTTP запросов
- python-dotenv для работы с .env файлом
- sqlite3 для базы данных

### Задание 1: Системный промпт

Системный промпт можно загрузить тремя способами:

**Способ 1 - из .env файла**

При запуске программа читает переменную SYSTEM_PROMPT из файла .env:

```python
SYSTEM_PROMPT = os.getenv("SYSTEM_PROMPT", "Ты дерзкий и резкий ассистент.")
```

**Способ 2 - ручной ввод**

Добавил команду setprompt, которая позволяет изменить промпт прямо во время работы:

```
Вы: setprompt
Введите новый системный промпт: Ты ассистент по имени Макс
Системный промпт изменён
```

**Способ 3 - сохранение в БД**

Создал таблицу prompts в SQLite для хранения разных вариантов промптов:

```sql
CREATE TABLE prompts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

Реализовал команды:
- saveprompt - сохранить текущий промпт или ввести новый
- loadprompt - загрузить промпт из БД
- listprompts - посмотреть все сохранённые промпты

Протестировал на примере создания промпта "Макс":

```
Вы: setprompt
Введите: Ты - ассистент по имени Макс. Когда спрашивают как тебя зовут, 
         ты отвечаешь: "Меня зовут Макс"

Вы: saveprompt
Сохранить текущий промпт? y
Название: max
Промпт сохранён

Вы: привет как тебя зовут?
AI: Меня зовут Макс.
```

Промпт работает корректно, ИИ следует инструкциям.

### Задание 2: Параметр temperature

Добавил команду settemp для изменения параметра temperature от 0 до 1. Этот параметр контролирует "креативность" модели - чем выше значение, тем более разнообразные и непредсказуемые ответы.

Провел эксперимент с вопросом "что такое ии?" при разных значениях temperature:

**Temperature = 0.1**
- Ответ короткий, около 100 слов
- При повторном вопросе ответ практически идентичный
- Только базовая информация

**Temperature = 0.5**
- Ответ средней длины, около 200 слов
- Структурированный, но не перегруженный деталями
- Баланс между краткостью и полнотой

**Temperature = 1.0**
- Ответ длинный, около 450 слов
- Множество примеров и детальных объяснений
- Максимальная детализация темы

Основное наблюдение: разница в длине ответов достигает 4.5 раз. При низких значениях модель выбирает только наиболее вероятные слова, поэтому ответы короткие и одинаковые. При высоких значениях модель "рискует" использовать менее вероятные варианты, отсюда разнообразие и детальность.

Для обычного диалога оптимальным оказалось значение 0.5-0.7.

### Задание 3: История диалога

Сначала реализовал через deque, но потом переделал на хранение в базе данных по просьбе преподавателя.

**Структура БД:**

Создал отдельную таблицу history в той же базе данных:

```sql
CREATE TABLE history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    role TEXT NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
)
```

**Как работает:**

1. После каждого диалога сохраняю два сообщения в БД:
```python
add_to_history("user", user_input)
add_to_history("assistant", answer)
```

2. При каждом новом запросе загружаю последние 6 сообщений:
```python
history_messages = get_history()  # SQL: SELECT ... ORDER BY id DESC LIMIT 6
```

3. После добавления нового сообщения автоматически удаляю старые:
```python
def clean_history():
    # Оставляет только последние 6 записей
    DELETE FROM history WHERE id NOT IN (
        SELECT id FROM history ORDER BY id DESC LIMIT 6
    )
```

**Проверка работоспособности:**

Тест 1 - проверил что ИИ запоминает информацию:

```
Вы: Меня зовут Дмитрий запомни
AI: Приятно познакомиться, Дмитрий!

Вы: как дела?
AI: У меня всё отлично! А как у вас, Дмитрий?

Вы: Как меня зовут?
AI: Вас зовут Дмитрий.
```

История работает, ИИ использует имя из предыдущих сообщений.

Тест 2 - проверил ограничение на 6 сообщений:

После того как отправил больше 3 пар сообщений, спросил снова про имя:

```
Вы: Как меня зовут?
AI: Я, к сожалению, не знаю вашего имени.
```

ИИ забыл имя, потому что это сообщение вышло за пределы истории. Значит ограничение работает правильно - в БД хранятся только последние 6 записей.

Дополнительно добавил команду showhistory для просмотра того, что сейчас в базе данных.

## Дополнительные функции

Кроме основных требований добавил:
- showprompt - показать текущий промпт
- showhistory - показать историю из БД
- clearhistory - очистить историю
- Визуальные индикаторы для команд

## Выводы

1. Temperature сильно влияет на поведение модели. При значении 0.1 получаются короткие предсказуемые ответы, при 1.0 - длинные и детальные. Оптимально использовать 0.5-0.7 для диалогов.

2. История диалога значительно улучшает качество общения. ИИ может вести связную беседу, помнит что говорил пользователь. Ограничение в 6 сообщений работает хорошо - этого достаточно для контекста, но не перегружает API.

3. Хранение истории в базе данных имеет преимущество перед хранением в памяти - история сохраняется между запусками программы. Также это позволяет анализировать все диалоги, которые были.

4. Системный промпт работает, но модель не всегда строго следует инструкциям. Нужны явные формулировки типа "ты ВСЕГДА отвечаешь" для лучшего результата.

Все три задания выполнены. Программа работает стабильно, все функции протестированы.

## Команды программы

- exit - выход
- settemp число - изменить temperature
- setprompt - изменить системный промпт
- showprompt - показать текущий промпт
- saveprompt - сохранить промпт в БД
- loadprompt - загрузить промпт из БД
- listprompts - список всех промптов
- deleteprompt - удалить промпт
- showhistory - показать историю диалога
- clearhistory - очистить историю

---
